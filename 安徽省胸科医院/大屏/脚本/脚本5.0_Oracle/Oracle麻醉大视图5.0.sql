CREATE OR REPLACE VIEW MEDSURGERY.V_MED_ANES_INFO AS
SELECT M.PATIENT_ID,
       M.VISIT_ID,
       M.OPER_ID,
       M.DEPT_STAYED,
       M.OPERATING_ROOM,
       M.OPERATING_ROOM_NO,
       M.DIAG_BEFORE_OPERATION,
       M.PATIENT_CONDITION,
       M.OPERATION_SCALE,
       M.DIAG_AFTER_OPERATION,
       M.EMERGENCY_INDICATOR,
       CASE WHEN M.EMERGENCY_INDICATOR=0 THEN '择期'
                  WHEN M.EMERGENCY_INDICATOR=1 THEN '急诊'
                  WHEN M.VISIT_ID=0 THEN '门诊'
       ELSE
                  '其他'
       END AS EINDICATOR,
       M.ISOLATION_INDICATOR,
       M.OPERATION_CLASS,
       M.DEPT_STAYED AS OPERATING_DEPT,
	   M.SURGEON || ',' || M.FIRST_ASSISTANT || ',' || M.SECOND_ASSISTANT || ',' || M.THIRD_ASSISTANT AS OPER_DOC,
       M.SURGEON,
       M.FIRST_ASSISTANT,
       M.SECOND_ASSISTANT,
       M.THIRD_ASSISTANT,
       M.FOURTH_ASSISTANT,
       M.ANESTHESIA_METHOD,
       '' ANESTHESIA_METHOD_CLASS,
	   M.ANESTHESIA_DOCTOR || ',' || M.SECOND_ANESTHESIA_DOCTOR || ',' || M.ANESTHESIA_ASSISTANT AS ANES_DOC,
       M.ANESTHESIA_DOCTOR,
       M.ANESTHESIA_ASSISTANT,
       M.BLOOD_TRAN_DOCTOR,
       M.FIRST_OPERATION_NURSE,
       M.SECOND_OPERATION_NURSE,
       M.FIRST_SUPPLY_NURSE,
       M.SECOND_SUPPLY_NURSE,
','|| M.FIRST_OPERATION_NURSE||','||
       M.SECOND_OPERATION_NURSE||','||
       M.FIRST_SUPPLY_NURSE||','||
       M.SECOND_SUPPLY_NURSE||',' AS NURSE_IDS,
       M.NURSE_SHIFT_INDICATOR,
       M.START_DATE_TIME,
       TO_CHAR(M.START_DATE_TIME,'yyyy-MM-dd') AS OPER_DATE,
       M.END_DATE_TIME,
       M.SATISFACTION_DEGREE,
       M.SMOOTH_INDICATOR,
       M.IN_FLUIDS_AMOUNT,
       M.OUT_FLUIDS_AMOUNT,
       M.BLOOD_LOSSED,
       M.BLOOD_TRANSFERED,
       M.ENTERED_BY,
       M.THIRD_SUPPLY_NURSE,
       M.ORDER_TRANSFER,
       M.CHARGE_TRANSFER,
       M.END_INDICATOR,
       M.RECK_GROUP,
       M.OPER_STATUS,
       M.SECOND_ANESTHESIA_ASSISTANT,
       M.THIRD_ANESTHESIA_ASSISTANT,
       M.FOURTH_ANESTHESIA_ASSISTANT,
       M.OPERATION_POSITION,
       M.OPERATION_EQUIP_INDICATOR,
       M.SECOND_ANESTHESIA_DOCTOR,
       M.THIRD_ANESTHESIA_DOCTOR,
       M.OTHER_IN_AMOUNT,
       M.OTHER_OUT_AMOUNT,
       M.IN_DATE_TIME,
       M.OUT_DATE_TIME,
       M.BLOOD_WHOLE_SELF,
       M.BLOOD_WHOLE,
       M.BLOOD_RBC,
       M.BLOOD_PLASM,
       M.BLOOD_OTHER,
       M.SPECIAL_EQUIPMENT,
       M.SPECIAL_INFECT,
       M.HEPATITIS_INDICATOR,
       M.ANES_START_DATE_TIME,
       M.RETURN_DATE_TIME,
       M.SEQUENCE,
       M.IN_PACU_DATE_TIME,
       M.OUT_PACU_DATE_TIME,
       CASE WHEN M.OUT_PACU_DATE_TIME IS NULL OR M.IN_PACU_DATE_TIME IS NULL THEN
         NULL
       ELSE
       TO_CHAR(ROUND((M.OUT_PACU_DATE_TIME-M.IN_PACU_DATE_TIME)*24.0,1),'fm9999990.09999') || '小时'
       END AS PACU_TIME,
       M.OPERATION_ID,
       M.BLOOD_REUSE,
       M.SELF_BLOOD,
       M.ENTERED_DATETIME,
       M.MEMO,
       M.ANESTHESIA_ID,
       M.XJ,
       M.AI,
       M.AT,
       M.JT,
       M.BODY_AREA,
       M.GAS_PIPE,
       M.PAT_LEAVE_SHOW,
       M.WHOLE_ANES,
       M.STOP_ANES_AREA,
       M.STOP_ANES_AREA_MED,
       M.HOLE_PIPLE_ANES,
       M.STOP_ANES_AREA_TECH,
       M.PIN_SIZE,
       M.PIPLE_UP,
       M.PIPLE_DOWN,
       M.IRRITATE_NERVE,
       M.ANES_RANGE,
       M.BAK_MED,
       M.WATCH_ANES,
       M.ALL_ANES_MED_LEAD1,
       M.ALL_ANES_MED_LEAD2,
       M.ALL_ANES_MED_KEEP1,
       M.ALL_ANES_MED_KEEP2,
       M.CHEST_WATER,
       M.ABDOMEN_WATER,
       M.INQUIRY_BEFORE_DATE,
       M.INQUIRY_AFTER_DATE,
       M.THIRD_OPERATION_NURSE,
       M.PACU_DOCTOR,
       M.WATER_JT1,
       M.WATER_JT2,
       M.BLOOD_XB,
       M.COOL_THING,
       M.CRY_WATHER,
       M.RED_BLOOD,
       M.BLOOD_AMOUNT,
       M.SCHEDULED_DATE_TIME,
       M.BED_NO,
       M.REQ_DATE_TIME,
       M.QIEKOU_CLASS,
       M.QIEKOU_NUMBER,
       M.MEMO1,
       M.OPERATION_NAME,
       M.MEN_ZHEN,
       M.ANESTHESIA_RESULT,
       M.SIMPLE_SICK,
       M.ISOLATION_NEED,
       M.DANBINGZHONG,
       M.YIBAO,
       M.FIRST_SHIFT_SUPPLY_NURSE,
       M.FIRST_SHIFT_OPERATION_NURSE,
       M.FIRST_SHIFT_SUPPLY_DATETIME,
       M.FIRST_SHIFT_OPERATION_DATETIME,
       M.ANES_START_TIME,
       M.ANES_END_TIME,
       M.INDUCE_START_TIME,
       M.INDUCE_END_TIME,
       M.PACU_START_TIME,
       M.PACU_END_TIME,
       M.DONE_DATE_TIME,
       M.CANCEL_DATE_TIME,
       M.ANALGESIC_PUMPS,
       I.INP_NO,
       I.NAME,
       I.NAME_PHONETIC,
       I.SEX,
       ROUND((M.SCHEDULED_DATE_TIME-I.DATE_OF_BIRTH)/365,0) AS AGE,
       I.DATE_OF_BIRTH,
       I.BIRTH_PLACE,
       I.CITIZENSHIP,
       I.NATION,
       I.ID_NO,
       I.IDENTITY,
       I.CHARGE_TYPE,
       I.UNIT_IN_CONTRACT,
       I.MAILING_ADDRESS,
       I.ZIP_CODE,
       I.PHONE_NUMBER_HOME,
       I.PHONE_NUMBER_BUSINESS,
       I.NEXT_OF_KIN,
       I.RELATIONSHIP,
       I.NEXT_OF_KIN_ADDR,
       I.NEXT_OF_KIN_ZIP_CODE,
       I.NEXT_OF_KIN_PHONE,
       I.LAST_VISIT_DATE,
       I.VIP_INDICATOR,
       I.CREATE_DATE,
       I.OPERATOR,
       P.ASA_GRADE,
       C.CANCEL_REASON,
       C.ENTERED_BY AS ENTERED_BY_CANCELED,
	   NULL AS CANCELED_DATE_TIME,
       DA.CANCELED_TYPE,
       DA.PACU_TEMPERATURE,
       DA.IN_ICU,
       DA.TRACHEA_6H,
       DA.TRACHEA_REMOVE,
       DA.ANES_START_24H_DEATH,
       DA.ANES_START_24H_STOP,
       DA.ANES_ANAPHYLAXIS,
       DA.SPINAL_ANES_COMP,
       DA.CENTRAL_VENOUS,
       DA.SPINAL_ANES,
       DA.TRACHEA_HOARSE,
       DA.AFTER_ANES_COMA,
       DA.GEN_ANES_TRACHEA,
       DA.PACU_SITUATION,
       DA.PACU_STEWARD,
       DA.PACU_DOCTOR AS PACU_DOCTOR_INPUT,
       DA.PACU_NURSE,
       DA.ANALGESIA_PUMP,
       DA.ANALGESIA_METHOD,
       DA.ANALGESIA_DRUGS,
       DA.ANALGESIA_EFFECT,
       DA.EXTRA_CIRCULATION,
       DA.ANALGESIA_THERAPY,
       DA.AFTER_ANALGESIA,
       DA.MONARY_RES,
       DA.MONARY_RES_OK,
       DA.CONS_DISTURBANCE,
       DA.OXYGEN_SATURATION,
       DA.USE_REMINDERS,
       DA.RES_TRACT_OBSTRUCE,
       DA.ANES_DEATH,
       DA.OTHER_NOT_EXP,
       DA.DEATH_AFTER_OPER,
       DA.NO_PLAN_IN_ICU,
	   DA.PAT_DIRECTION
  FROM MED_OPERATION_MASTER M
  LEFT JOIN MED_PAT_MASTER_INDEX I
    ON I.PATIENT_ID = M.PATIENT_ID
  LEFT JOIN MED_ANESTHESIA_PLAN P
    ON P.PATIENT_ID = M.PATIENT_ID
   AND P.VISIT_ID = M.VISIT_ID
   AND P.OPER_ID = M.OPER_ID
  LEFT JOIN MED_OPERATION_CANCELED C
    ON C.PATIENT_ID = M.PATIENT_ID
   AND C.VISIT_ID = M.VISIT_ID
   AND C.OPER_ID = M.OPER_ID
  LEFT JOIN MEDSURGERY.MED_ANESTHESIA_INPUT_DATA DA
    ON DA.PATIENT_ID = M.PATIENT_ID
   AND DA.VISIT_ID = M.VISIT_ID
   AND DA.OPER_ID = M.OPER_ID;
