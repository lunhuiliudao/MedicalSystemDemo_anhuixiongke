CREATE OR REPLACE VIEW SURGERY.V_MED_ANES_INFO AS
SELECT M.PATIENT_ID,
       M.VISIT_ID,
       M.OPER_ID,
       M.DEPT_STAYED,
       M.OPERATING_ROOM,
       M.OPERATING_ROOM_NO,
       M.DIAG_BEFORE_OPERATION,
       M.PATIENT_CONDITION,
       M.OPERATION_SCALE,
       M.DIAG_AFTER_OPERATION,
       M.EMERGENCY_INDICATOR,
       CASE WHEN M.EMERGENCY_INDICATOR=0 THEN '择期'
                  WHEN M.EMERGENCY_INDICATOR=1 THEN '急诊'
                  WHEN M.VISIT_ID=0 THEN '门诊'
       ELSE
                  '其他'
       END AS EINDICATOR,
       M.ISOLATION_INDICATOR,
       M.OPERATION_CLASS,
       M.DEPT_STAYED AS OPERATING_DEPT,
	   M.SURGEON || ',' || M.FIRST_ASSISTANT || ',' || M.SECOND_ASSISTANT || ',' || M.THIRD_ASSISTANT AS OPER_DOC,
       M.SURGEON,
       M.FIRST_ASSISTANT,
       M.SECOND_ASSISTANT,
       M.THIRD_ASSISTANT,
       M.FOURTH_ASSISTANT,
       M.ANESTHESIA_METHOD,
	   M.ANESTHESIA_DOCTOR || ',' || M.SECOND_ANESTHESIA_DOCTOR || ',' || M.ANESTHESIA_ASSISTANT AS ANES_DOC,
       M.ANESTHESIA_DOCTOR,
       M.ANESTHESIA_ASSISTANT,
       M.BLOOD_TRAN_DOCTOR,
       M.FIRST_OPERATION_NURSE,
       M.SECOND_OPERATION_NURSE,
       M.FIRST_SUPPLY_NURSE,
       M.SECOND_SUPPLY_NURSE,
','|| M.FIRST_OPERATION_NURSE||','||
       M.SECOND_OPERATION_NURSE||','||
       M.FIRST_SUPPLY_NURSE||','||
       M.SECOND_SUPPLY_NURSE||',' AS NURSE_IDS,
       M.NURSE_SHIFT_INDICATOR,
       M.START_DATE_TIME,
       TO_CHAR(M.START_DATE_TIME,'yyyy-MM-dd') AS OPER_DATE,
       M.END_DATE_TIME,
       M.SATISFACTION_DEGREE,
       M.SMOOTH_INDICATOR,
       M.IN_FLUIDS_AMOUNT,
       M.OUT_FLUIDS_AMOUNT,
       M.BLOOD_LOSSED,
       M.BLOOD_TRANSFERED,
       M.ENTERED_BY,
       M.THIRD_SUPPLY_NURSE,
       M.ORDER_TRANSFER,
       M.CHARGE_TRANSFER,
       M.END_INDICATOR,
       M.RECK_GROUP,
       M.OPER_STATUS,
       M.SECOND_ANESTHESIA_ASSISTANT,
       M.THIRD_ANESTHESIA_ASSISTANT,
       M.FOURTH_ANESTHESIA_ASSISTANT,
       M.OPERATION_POSITION,
       M.OPERATION_EQUIP_INDICATOR,
       M.SECOND_ANESTHESIA_DOCTOR,
       M.THIRD_ANESTHESIA_DOCTOR,
       M.OTHER_IN_AMOUNT,
       M.OTHER_OUT_AMOUNT,
       M.IN_DATE_TIME,
       M.OUT_DATE_TIME,
       M.BLOOD_WHOLE_SELF,
       M.BLOOD_WHOLE,
       M.BLOOD_RBC,
       M.BLOOD_PLASM,
       M.BLOOD_OTHER,
       M.SPECIAL_EQUIPMENT,
       M.SPECIAL_INFECT,
       M.HEPATITIS_INDICATOR,
       M.ANES_START_DATE_TIME,
       M.RETURN_DATE_TIME,
       M.SEQUENCE,
       M.IN_PACU_DATE_TIME,
       M.OUT_PACU_DATE_TIME,
       CASE WHEN M.OUT_PACU_DATE_TIME IS NULL OR M.IN_PACU_DATE_TIME IS NULL THEN
         NULL
       ELSE
       TO_CHAR(ROUND((M.OUT_PACU_DATE_TIME-M.IN_PACU_DATE_TIME)*24.0,1),'fm9999990.09999') || '小时'
       END AS PACU_TIME,
       M.OPERATION_ID,
       M.BLOOD_REUSE,
       M.SELF_BLOOD,
       M.ENTERED_DATETIME,
       M.MEMO,
       M.ANESTHESIA_ID,
       '' ANESTHESIA_METHOD_CLASS,
       '' XJ,
       '' AI,
       '' AT,
       '' JT,
       '' BODY_AREA,
       '' GAS_PIPE,
       '' PAT_LEAVE_SHOW,
       '' WHOLE_ANES,
       '' STOP_ANES_AREA,
       '' STOP_ANES_AREA_MED,
       '' HOLE_PIPLE_ANES,
       '' STOP_ANES_AREA_TECH,
       '' PIN_SIZE,
       '' PIPLE_UP,
       '' PIPLE_DOWN,
       '' IRRITATE_NERVE,
       '' ANES_RANGE,
       '' BAK_MED,
       '' WATCH_ANES,
       '' ALL_ANES_MED_LEAD1,
       '' ALL_ANES_MED_LEAD2,
       '' ALL_ANES_MED_KEEP1,
       '' ALL_ANES_MED_KEEP2,
       '' CHEST_WATER,
       '' ABDOMEN_WATER,
       '' INQUIRY_BEFORE_DATE,
       '' INQUIRY_AFTER_DATE,
       '' THIRD_OPERATION_NURSE,
       '' PACU_DOCTOR,
       '' WATER_JT1,
       '' WATER_JT2,
       '' BLOOD_XB,
       '' COOL_THING,
       '' CRY_WATHER,
       '' RED_BLOOD,
       '' BLOOD_AMOUNT,
       S.SCHEDULED_DATE_TIME,
       P.BED_NO,
       '' REQ_DATE_TIME,
       '' QIEKOU_CLASS,
       '' QIEKOU_NUMBER,
       '' MEMO1,
       N.OPERATION OPERATION_NAME,
       '' MEN_ZHEN,
       '' ANESTHESIA_RESULT,
       '' SIMPLE_SICK,
       '' ISOLATION_NEED,
       '' DANBINGZHONG,
       '' YIBAO,
       '' FIRST_SHIFT_SUPPLY_NURSE,
       '' FIRST_SHIFT_OPERATION_NURSE,
       '' FIRST_SHIFT_SUPPLY_DATETIME,
       '' FIRST_SHIFT_OPERATION_DATETIME,
       P.ANES_START_TIME,
       P.ANES_END_TIME,
       '' INDUCE_START_TIME,
       '' INDUCE_END_TIME,
       '' PACU_START_TIME,
       '' PACU_END_TIME,
       '' DONE_DATE_TIME,
       '' CANCEL_DATE_TIME,
       '' ANALGESIC_PUMPS,
       I.INP_NO,
       I.NAME,
       I.NAME_PHONETIC,
       I.SEX,
       ROUND((M.START_DATE_TIME-I.DATE_OF_BIRTH)/365,0) AS AGE,
       I.DATE_OF_BIRTH,
       I.BIRTH_PLACE,
       I.CITIZENSHIP,
       I.NATION,
       I.ID_NO,
       I.IDENTITY,
       I.CHARGE_TYPE,
       I.UNIT_IN_CONTRACT,
       I.MAILING_ADDRESS,
       I.ZIP_CODE,
       I.PHONE_NUMBER_HOME,
       I.PHONE_NUMBER_BUSINESS,
       I.NEXT_OF_KIN,
       I.RELATIONSHIP,
       I.NEXT_OF_KIN_ADDR,
       I.NEXT_OF_KIN_ZIP_CODE,
       I.NEXT_OF_KIN_PHONE,
       I.LAST_VISIT_DATE,
       I.VIP_INDICATOR,
       I.CREATE_DATE,
       I.OPERATOR,
       P.ASA_GRADE,
     '' AS CANCEL_REASON,
       '' AS ENTERED_BY_CANCELED,
	   NULL AS CANCELED_DATE_TIME,
       DA.CANCELED_TYPE,
       DA.PACU_TEMPERATURE,
       DA.IN_ICU,
       DA.TRACHEA_6H,
       DA.TRACHEA_REMOVE,
       DA.ANES_START_24H_DEATH,
       DA.ANES_START_24H_STOP,
       DA.ANES_ANAPHYLAXIS,
       DA.SPINAL_ANES_COMP,
       DA.CENTRAL_VENOUS,
       DA.SPINAL_ANES,
       DA.TRACHEA_HOARSE,
       DA.AFTER_ANES_COMA,
       DA.GEN_ANES_TRACHEA,
       DA.PACU_SITUATION,
       DA.PACU_STEWARD,
       DA.PACU_DOCTOR AS PACU_DOCTOR_INPUT,
       DA.PACU_NURSE,
       DA.ANALGESIA_PUMP,
       DA.ANALGESIA_METHOD,
       DA.ANALGESIA_DRUGS,
       DA.ANALGESIA_EFFECT,
       DA.EXTRA_CIRCULATION,
       DA.ANALGESIA_THERAPY,
       DA.AFTER_ANALGESIA,
       DA.MONARY_RES,
       DA.MONARY_RES_OK,
       DA.CONS_DISTURBANCE,
       DA.OXYGEN_SATURATION,
       DA.USE_REMINDERS,
       DA.RES_TRACT_OBSTRUCE,
       DA.ANES_DEATH,
       DA.OTHER_NOT_EXP,
       DA.DEATH_AFTER_OPER,
       DA.NO_PLAN_IN_ICU,
       DA.PAT_DIRECTION
  FROM MED_OPERATION_MASTER M
  LEFT JOIN MED_PAT_MASTER_INDEX I
    ON I.PATIENT_ID = M.PATIENT_ID
  LEFT JOIN MED_ANESTHESIA_PLAN P
    ON P.PATIENT_ID = M.PATIENT_ID
   AND P.VISIT_ID = M.VISIT_ID
   AND P.OPER_ID = M.OPER_ID
  LEFT JOIN SURGERY.MED_ANESTHESIA_INPUT_DATA DA
    ON DA.PATIENT_ID = M.PATIENT_ID
   AND DA.VISIT_ID = M.VISIT_ID
   AND DA.OPER_ID = M.OPER_ID
   LEFT JOIN MED_OPERATION_NAME N
   ON N.PATIENT_ID=M.PATIENT_ID AND N.VISIT_ID=M.VISIT_ID AND N.OPER_ID=M.OPER_ID AND N.OPERATION_NO=1
   LEFT JOIN MED_OPERATION_SCHEDULE S ON S.PATIENT_ID=M.PATIENT_ID AND S.VISIT_ID=M.VISIT_ID
   AND S.OPER_ID=M.OPER_ID;
